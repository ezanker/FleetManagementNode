<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>EZ Multi-view</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no, minimal-ui" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta http-equiv="cleartype" content="on" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0" />
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico?v1.88" />


    <link href="scripts/kendo/styles/kendo.common-material.min.css" rel="stylesheet" />
    <link href="scripts/kendo/styles/kendo.materialblack.min.css" rel="stylesheet" />
    <link href="scripts/kendo/styles/kendo.materialblack.mobile.min.css" rel="stylesheet" />

    <style>
        html, body {
            overflow: hidden;
            background: #303030;
            font-family: Arial,Verdana, sans-serif;
        }

        #contentDiv {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 0;
        }

        #ButtonRow {
            margin: 0;
            padding: 8px 4px;
            background-color: #3F51B5;
            color: white;
        }

        .padLeft{
            padding-left: 0.67em;
        }

        .lbl{
            font-size: 88%;
            color: #ddd;
        }

        .PortLabel {
            position: absolute;
            left: 50%;
            top: 0;
            transform: translate(-50%, 0%);
            transform-origin: center;
            transition: all .75s ease-in-out;
            padding: 0.15em 0.75em;
            font-size: 11px;
            font-weight: bold;
            background: rgba(192,192,192,1);
            color: #303030;
            box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
        }
        .ReloadButton{
            position: absolute;
            left: 0;
            top: 0;
            background: rgba(192,192,192,1);
            color: #303030;
            box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
            cursor:pointer;
        }
        .ReloadButton:hover{
            background: rgba(228,228,228,1);
            color: #3F51B5;
        }


        .HideLabel{
            transform: translateY(-100%) scale(0.32,0.32);
            opacity: 0;
        }
        .hidden {
            display: none;
        }
        .MaxButton, .PUButton, .PortLabelButton, .RecentButton{
            padding-left: 6px;
            padding-right: 6px;
        }

        .logo {
            position: absolute;
            top: 2px;
            right: 2px;
        }
        .logo img {
            width: 32px;
            height: 32px;
        }
        #walamarticon{
            position: absolute;
            top: 26px;
            right: 3px;
        }

        .InsetLogo{
            font-size: 12px;
            font-weight: 800;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.65);
            color: #dbcec6;
            position: absolute;
            right: 2px;
            top: 0px;
        }

        .CurrentInfoTable{
            border-collapse: collapse;
            border: 1px solid rgba(71,71,71,0.35);

        }
        .CurrentInfoTable th {
            text-align: center;
            font-size: 88%;
            color: #bbb;
            padding: 2px 8px;
            border: 1px solid rgba(71,71,71,0.35);
        }
        .CurrentInfoTable td {
            text-align: center;
            padding: 2px 8px;
            border: 1px solid rgba(71,71,71,0.35);

        }


        #winConfig{
            overflow:auto;
        }

        .port-selector input{
            /*position:absolute;*/
            /*z-index:999;*/
            margin:0;padding:0;
            -webkit-appearance:none;
               -moz-appearance:none;
                    appearance:none;

        }

        .port5{background-image:url(images/PortConfig_5Ports.svg?v=1);}
        .port4{background-image:url(images/PortConfig_4Ports.svg?v=1);}
        .port3{background-image:url(images/PortConfig_3Ports.svg?v=1);}
        .port2{background-image:url(images/PortConfig_2Ports.svg?v=1);}
        .port1{background-image:url(images/PortConfig_1Port.svg?v=1);}

        .port-selector input:active +.portsel{opacity: .9;}
        .port-selector input:checked +.portsel{
            -webkit-filter: none;
               -moz-filter: none;
                    filter: none;
            box-shadow: 0 2px 6px 0 rgba(0,0,0,.4)
        }

        .portsel{
            cursor:pointer;
            background-size:contain;
            background-repeat:no-repeat;
            display:inline-block;
            width:128px;height:128px;
            -webkit-transition: all 100ms ease-in;
               -moz-transition: all 100ms ease-in;
                    transition: all 100ms ease-in;
            -webkit-filter: brightness(1.8) grayscale(1) opacity(.47);
               -moz-filter: brightness(1.8) grayscale(1) opacity(.47);
                    filter: brightness(1.8) grayscale(1) opacity(.47);            
        }
        .portsel:hover{
            -webkit-filter: brightness(1.2) grayscale(.5) opacity(.85);
               -moz-filter: brightness(1.2) grayscale(.5) opacity(.85);
                    filter: brightness(1.2) grayscale(.5) opacity(.85);
        }

        .content-picker-cont{
            margin-top:1.25em;

        }
        .content-picker {
            margin-top:1em;
        }
        .action-buttons-cont {
            text-align: right;
            margin-top:1.67em;
        }

        #NotePadFrame{
            display: none;
            position: absolute;
            top: 50px;
            left: 50px;
            z-index: 10000;
            width: 540px; 
            height: 60vh;
            background: #FFF;
            box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
            border: 0;
        }
        .reservedImg{
            position: absolute;
            z-index: 10000;
            left: 2px;
            top: 1px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
            color: white;
            border: 1px solid red;
            padding: 0px 6px;
            border-radius: 4px;
            background: red;
            
        }

        .badge {
            position: absolute;
            background-color: #34BEDA;
            color: white;
            font-weight: bold;
            font-size: 13px;
            border-radius: 33%;
            padding: 2px 5px;
            z-index: 10000;
            box-shadow: 0 6px 6px rgba(0,0,0,0.23);
            cursor: pointer;
        }


    </style>


</head>
<body>
    <div id="contentDiv">
        <div id="ButtonRow">
            <span id="ReservedImg" class="k-icon k-i-user reservedImg hidden"></span>
            <span id="NotesBadge" class="badge hidden" title="new notes">1</span>
            <label class="hidden">
                DB:
                <input id="txtNum" type="number" title="Enter desired DB number and click GO" value="1" min="0" max="999999999" style="width: 100px;" />
            </label>
            <button id="btnGo" type="button" title="Load selected BAR" class="hidden">Go</button>

            <label>
                <span class="lbl" title="Select desired BAR">BAR:</span>
                <input id="ddBAR" style="width: 128px;" />
            </label>
            <label>
                <span class="lbl" title="Select desired Store ID">Store:</span>
                <input id="ddSTORE" style="width: 98px;" />
            </label>

            <span id="lblrecent" class="padLeft lbl" style="cursor:pointer;" title="Click to toggle visibility of list of recents">Recent: </span>
            <span id="recent"></span>

            <span class="padLeft lbl">Popups:</span>
            <span id="popupsCont">
                <button id="btnUser" type="button" class="k-button PortLabelButton " data-role="button">
                    <span class="k-icon k-i-login" style="font-size: 22px;"></span>
                </button>
                <button id="btnVerif" type="button" class="k-button PUButton" data-role="button" title="Popup verification">V</button>
                <button id="btnDevops" type="button" class="k-button PUButton" data-role="button" title="Popup jira" style="padding: 10px 4px;">
                    <img src="images/jira.svg" style="width: 18px; height: 18px;" />
                </button>
                <button id="btnQuickbase" type="button" class="k-button PUButton" data-role="button" title="Popup quickbase" style="padding: 10px 2px;">
                    <img src="images/quickbase.svg" style="height: 18px;" />
                </button>
                <button id="btnWalmart" type="button" class="k-button PUButton" data-role="button" title="Popup Walmart Skybox">W</button>
                <button id="btnConsole" type="button" class="k-button PUButton" data-role="button" title="Popup Web Shell Linux Console">C</button>
            </span>

            <span class="padLeft lbl">Maximize:</span>
            <span id="maximizeCont">
                <button type="button" class="k-button MaxButton" data-role="button" title="Maximize port 1" data-portnum="1">1</button>
                <button type="button" class="k-button MaxButton" data-role="button" title="Maximize port 2" data-portnum="2">2</button>
                <button type="button" class="k-button MaxButton" data-role="button" title="Maximize port 3" data-portnum="3">3</button>
                <button type="button" class="k-button MaxButton" data-role="button" title="Maximize port 4" data-portnum="4">4</button>
                <button type="button" class="k-button MaxButton" data-role="button" title="Maximize port 5" data-portnum="5">5</button>
            </span>

            <span style="padding-left: 1em;">
                <button id="btnPortLbls" type="button" class="k-button PortLabelButton" data-role="button" title="Toggle port labels">
                    <span class="k-icon k-i-eye" style="font-size: 22px; "></span>
                </button>
                <button id="btnNewTab" type="button" class="k-button PortLabelButton" data-role="button" title="Open in new tab">
                    <span class="k-icon k-i-hyperlink-open-sm" style="font-size: 22px; "></span>
                </button>
                <button id="btnConfig" type="button" class="k-button PortLabelButton" data-role="button" title="Configure ports">
                    <span class="k-icon k-i-cog" style="font-size: 22px; "></span>
                </button>
                <button id="btnNotes" type="button" class="k-button PortLabelButton" data-role="button" title="Skybox Notepad Service Log">
                    <span class="k-icon k-i-track-changes-enable" style="font-size: 22px; "></span>
                </button>                
                <button id="btnKB" type="button" class="k-button PortLabelButton" data-role="button" title="Knowledge Base">
                    <span class="k-icon k-i-information" style="font-size: 22px; "></span>
                </button>
                <button id="btnJira" type="button" class="k-button PortLabelButton" data-role="button" title="Toggle visibility of the Jira ticket widget" style="padding: 10px 4px;">
                    <img src="images/jiraWidget.svg" style="width: 18px; height: 18px;" />
                </button>
            </span>

            <div style="position: absolute; top: 6px; right: 24px; background-color: #3F51B5">
                <table class="CurrentInfoTable">
                    <tr><th>Active:</th><th>Phone # / Store ID:</th></tr>
                    <tr>
                        <td><span id="currentBAR" title="Currently loaded BAR"></span></td>
                        <td><span id="currentPHONE" title="Store phone number and ID"></span></td>
                    </tr>
                </table>
            </div>

            <span class="logo">
                <span class="InsetLogo">
                    EZ
                </span>
            </span>
            <span id="walamarticon" class="hidden">
                <img src="images/walmart.png" />
            </span>
        </div>

        <div id="vertical">


        </div>

    </div>

    <iframe id="NotePadFrame" src="about:blank" ></iframe>
    <!-- popup window container -->
    <div style="display: none;">
        <div id="winPU"></div>
        <div id="winMax"></div>

        <div id="winConfig">

            <div class="port-selector">

                <label for="Port5" title="5 ports">
                    <input id="Port5" checked="checked" type="radio" name="PortSelect" value="5" />
                    <span class="portsel port5"></span>
                </label>

                <label for="Port4" title="4 ports">
                    <input id="Port4" type="radio" name="PortSelect" value="4" />
                    <span class="portsel port4"></span>
                </label>

                <label for="Port3" title="3 ports">
                    <input id="Port3" type="radio" name="PortSelect" value="3" />
                    <span class="portsel port3"></span>
                </label>
                <label for="Port2" title="2 ports">
                    <input id="Port2" type="radio" name="PortSelect" value="2" />
                    <span class="portsel port2"></span>
                </label>
                <label for="Port1" title="1 port">
                    <input id="Port1" type="radio" name="PortSelect" value="1" />
                    <span class="portsel port1"></span>
                </label>

            </div>

            <div class="content-picker-cont" style="padding-left: 1em;">
                <div id="p1Page" class="content-picker">
                    <label>
                        Port 1 content:&nbsp;&nbsp;
                        <input id="p1Content" style="width: 360px;" />
                    </label>
                </div>
                <div id="p2Page" class="content-picker hide1">
                    <label>
                        Port 2 content:&nbsp;&nbsp;
                        <input id="p2Content" style="width: 360px;" />
                    </label>
                </div>
                <div id="p3Page" class="content-picker hide1 hide2">
                    <label>
                        Port 3 content:&nbsp;&nbsp;
                        <input id="p3Content" style="width: 360px;" />
                    </label>
                </div>
                <div id="p4Page" class="content-picker hide1 hide3 hide2">
                    <label>
                        Port 4 content:&nbsp;&nbsp;
                        <input id="p4Content" style="width: 360px;" />
                    </label>
                </div>
                <div id="p5Page" class="content-picker hide1 hide4 hide3 hide2">
                    <label>
                        Port 5 content:&nbsp;&nbsp;
                        <input id="p5Content" style="width: 360px;" />
                    </label>
                </div>

            </div>

            <div class="action-buttons-cont" style="margin: 1em -1em 0 -1em; padding: 1em 1em 0 1em; border-top: 1px solid rgb(77,77,77);">
                <button id="btnDefConfig" type="button" class="k-button " data-role="button" title="Use default 5 port configuration">Default</button>
                <button id="btnSaveConfig" type="button" class="k-button k-primary" data-role="button" title="Save selected port configuration">Save</button>
                <button id="btnCancelConfig" type="button" class="k-button " data-role="button" title="">Cancel</button>
            </div>
        </div>
    </div>


    <script data-jsd-embedded data-key="5641d795-dc64-45d0-a31e-7ebb24d3ade7" data-base-url="https://jsd-widget.atlassian.com" src="https://jsd-widget.atlassian.com/assets/embed.js"></script>

    <script src="scripts/jquery-3.4.1.min.js?v=1"></script>
    <script src="scripts/kendo/js/kendo.ui.core.min.js?v=1"></script>
    <script src="scripts/jQuery-csv.js?v=1"></script>

    <!--templates-->
    <script id="Port5Template" type="text/x-kendo-template">
        <div id="vertical" data-numports="5" style="height: 1000px;">
            <div id="top-pane">
                <div id="horizontalT" style="height: 100%; width: 100%;">
                    <div id="Port1">
                        <iframe id="F1" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                        <span class="PortLabel">#: P1Title #</span>
                        <span class="ReloadButton" data-portnum="F1"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
                    </div>
                    <div id="Port2">
                        <iframe id="F2" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                        <span class="PortLabel">#: P2Title #</span>
                        <span class="ReloadButton" data-portnum="F2"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
                    </div>
                </div>
            </div>
            <div id="bottom-pane">
                <div id="horizontalB" style="height: 100%; width: 100%;">
                    <div id="Port3">
                        <iframe id="F3" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                        <span class="PortLabel">#: P3Title #</span>
                        <span class="ReloadButton" data-portnum="F3"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
                    </div>
                    <div id="Port4">
                        <iframe id="F4" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                        <span class="PortLabel">#: P4Title #</span>
                        <span class="ReloadButton" data-portnum="F4"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
                    </div>
                    <div id="Port5">
                        <iframe id="F5" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                        <span class="PortLabel">#: P5Title #</span>
                        <span class="ReloadButton" data-portnum="F5"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script id="Port4Template" type="text/x-kendo-template">
        <div id="vertical" data-numports="4" style="height: 1000px;">
            <div id="top-pane">
                <div id="horizontalT" style="height: 100%; width: 100%;">
                    <div id="Port1">
                        <iframe id="F1" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                        <span class="PortLabel">#: P1Title #</span>
                        <span class="ReloadButton" data-portnum="F1"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
                    </div>
                    <div id="Port2">
                        <iframe id="F2" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                        <span class="PortLabel">#: P2Title #</span>
                        <span class="ReloadButton" data-portnum="F2"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
                    </div>
                </div>
            </div>
            <div id="bottom-pane">
                <div id="horizontalB" style="height: 100%; width: 100%;">
                    <div id="Port3">
                        <iframe id="F3" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                        <span class="PortLabel">#: P3Title #</span>
                        <span class="ReloadButton" data-portnum="F3"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
                    </div>
                    <div id="Port4">
                        <iframe id="F4" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                        <span class="PortLabel">#: P4Title #</span>
                        <span class="ReloadButton" data-portnum="F4"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <script id="Port3Template" type="text/x-kendo-template">
        <div id="vertical" data-numports="3" style="height: 1000px;">
            <div id="bottom-pane">
                <div id="horizontalB" style="height: 100%; width: 100%;">
                    <div id="Port1">
                        <iframe id="F1" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                        <span class="PortLabel">#: P1Title #</span>
                        <span class="ReloadButton" data-portnum="F1"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
                    </div>
                    <div id="Port2">
                        <iframe id="F2" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                        <span class="PortLabel">#: P2Title #</span>
                        <span class="ReloadButton" data-portnum="F2"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
                    </div>
                </div>
            </div>
            <div id="top-pane">
                <div id="horizontalT" style="height: 100%; width: 100%;">
                    <div id="Port3">
                        <iframe id="F3" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                        <span class="PortLabel">#: P3Title #</span>
                        <span class="ReloadButton" data-portnum="F3"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
                    </div>
                </div>
            </div>

        </div>
    </script>

    <script id="Port2Template" type="text/x-kendo-template">
        <div id="vertical" data-numports="2" style="height: 1000px;">
            <div id="Port1">
                <iframe id="F1" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                <span class="PortLabel">#: P1Title #</span>
                <span class="ReloadButton" data-portnum="F1"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
            </div>
            <div id="Port2">
                <iframe id="F2" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                <span class="PortLabel">#: P2Title #</span>
                <span class="ReloadButton" data-portnum="F2"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
            </div>
        </div>
    </script>

    <script id="Port1Template" type="text/x-kendo-template">
        <div id="vertical" data-numports="1" style="height: 1000px;">
            <div id="Port1">
                <iframe id="F1" src="about:blank" frameborder="0" class="k-content-frame" style="height: 100%; width: 100%;"></iframe>
                <span class="PortLabel">#: P1Title #</span>
                <span class="ReloadButton" data-portnum="F1"><span class="k-icon k-i-reload-sm" style="font-size: 10px; "></span></span>
            </div>
        </div>
    </script>



    <script>
        //Generates a Guid
        function generateUUID() {
            var d = new Date().getTime();
            var d2 = (performance && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported
            var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16;
                if(d > 0){
                    var r = (d + r)%16 | 0;
                    d = Math.floor(d/16);
                } else {
                    var r = (d2 + r)%16 | 0;
                    d2 = Math.floor(d2/16);
                }
                return (c=='x' ? r : (r&0x7|0x8)).toString(16);
            });
            return uuid;
        };

        //each time the page loads, generate a 
        //unique session ID used to  reserve BARs
        var sessionID = generateUUID();
        var LastNoteCheck = new Date().getTime();

        var PageTitles = {};
        PageTitles["position"] = "BARViz";
        PageTitles["info"] = "Robot Control Status Information";
        PageTitles["commands"] = "Command Center";
        PageTitles["lifecycle-transitions"] = "Life-Cycle State Transition Information";
        PageTitles["play-executions"] = "Play Execution Map";
        PageTitles["notepad"] = "Skybox Notepad Service Log";
        PageTitles["kb"] = "Knowledge Base";
        PageTitles["skybox-bot-list"] = "Skybox Bot List";


        var TitleFromPage = function (page) {
            var title = "none";
            if (page && page.length > 0) {
                title = PageTitles[page];
            }
            return title;
        }

        var DefaultPortConfiguration = {
            P1Page: "position",
            P2Page: "info",
            P3Page: "commands",
            P4Page: "lifecycle-transitions",
            P5Page: "play-executions",
            NumberPorts: 5
        };


        var SaveSizesFunctions = {
            SaveSizeKey: "PortSizesKey",
            SaveRecentKey: "RecentBARKey",
            SavePortLblbVisKey: "PortLabelVisKey",
            SavePortConfigKey: "PortConfigKey",
            SaveUserNameKey: "UserName2Key",

            SaveSizes: function (sizes, numports) {
                if (numports > 0) {
                    localStorage.setItem(SaveSizesFunctions.SaveSizeKey + numports, JSON.stringify(sizes));
                }
            },
            GetSaveSizes: function (numports) {
                if (numports < 2) return null;
                var sizes = localStorage.getItem(SaveSizesFunctions.SaveSizeKey + numports);
                return sizes ? JSON.parse(sizes) : null;
            },

            SaveRecent: function (recent) {
                localStorage.setItem(SaveSizesFunctions.SaveRecentKey, JSON.stringify(recent));
            },
            GetRecent: function () {
                var recent = localStorage.getItem(SaveSizesFunctions.SaveRecentKey);
                return recent ? JSON.parse(recent) : [];
            },

            SavePortLblbVis: function (IsVis) {
                localStorage.setItem(SaveSizesFunctions.SavePortLblbVisKey, JSON.stringify(IsVis));
            },
            GetPortLblbVis: function () {
                var IsVis = localStorage.getItem(SaveSizesFunctions.SavePortLblbVisKey);
                return IsVis ? JSON.parse(IsVis) : false;
            },
            SavePortConfig: function (config) {
                localStorage.setItem(SaveSizesFunctions.SavePortConfigKey, JSON.stringify(config));
            },
            GetPorConfig: function () {
                var config = localStorage.getItem(SaveSizesFunctions.SavePortConfigKey);
                return config ? JSON.parse(config) : DefaultPortConfiguration;
            },

            SaveUserName: function (user) {
                localStorage.setItem(SaveSizesFunctions.SaveUserNameKey, user);
            },
            GetUserName: function () {
                var user = localStorage.getItem(SaveSizesFunctions.SaveUserNameKey);
                return user ? user : "";
            },

        };

        function StoreCompare(a, b) {
            return alphanum(a.STORE_SITE_ID, b.STORE_SITE_ID);
        }

        function alphanum(a, b) {
            function chunkify(t) {
                var tz = new Array();
                var x = 0, y = -1, n = 0, i, j;

                while (i = (j = t.charAt(x++)).charCodeAt(0)) {
                    var m = (i == 46 || (i >= 48 && i <= 57));
                    if (m !== n) {
                        tz[++y] = "";
                        n = m;
                    }
                    tz[y] += j;
                }
                return tz;
            }

            var aa = chunkify(a);
            var bb = chunkify(b);

            for (x = 0; aa[x] && bb[x]; x++) {
                if (aa[x] !== bb[x]) {
                    var c = Number(aa[x]), d = Number(bb[x]);
                    if (c == aa[x] && d == bb[x]) {
                        return c - d;
                    } else return (aa[x] > bb[x]) ? 1 : -1;
                }
            }
            return aa.length - bb.length;
        }


        //Main module
        var MainModule = function () {
            var me = {};

            me.PortConfiguration = {
                P1Page: "position",
                P2Page: "info",
                P3Page: "commands",
                P4Page: "lifecycle-transitions",
                P5Page: "play-executions",
                NumberPorts: 5
            };

            var baseURL = "https://fleet-admin.badger-technologies.com/robots/";
            var datacsvfile = "./BARs.csv?v=1.1";
            var recent = [];
            var currentBar;
            var QueryDB = -1
            var IsWalmart = false;
            var BARs = [];
            var STOREs = [];
            var NotePadURL = "http://10.210.232.187:3000";
            me.KBURL = "http://10.210.233.122:220/index.php";
            me.SkyboxListURL = "https://fleet-admin.badger-technologies.com/skybox";

            var ReserveTimer = null;
            var NotesTimer = null;
            var ConcurrentUser = "";

            me.config = {
                SplitterElem: $("#horizontalSplitPane"),
                ContentDivElem: $("#contentDiv"),
                ButtonRowElem: $("#ButtonRow"),
                GridDivElem: $("#SearchGrid"),
                BARNumElem: $("#txtNum"),
                BARNumSelElem: $("#ddBAR"),
                STORENumSelElem: $("#ddSTORE"),
                GoBtnElem: $("#btnGo"),
                currentBARElem: $("#currentBAR"),
                currentPHONEElem: $("#currentPHONE"),
                recentElem: $("#recent"),
                recentLblElem: $("#lblrecent"),
                MaximizeContainerElem: $("#maximizeCont"),
                VerifPopupBtnElem: $("#btnVerif"),
                DevopsPopupBtnElem: $("#btnDevops"),
                ConsolePopupBtnElem: $("#btnConsole"),
                QuickBasePopupBtnElem: $("#btnQuickbase"),
                WalmartPopupBtnElem: $("#btnWalmart"),
                PopupWinElem: $("#winPU"),
                MaxPortWinElem: $("#winMax"),
                ConfigWinElem: $("#winConfig"),
                PortLblsBtnElem: $("#btnPortLbls"),
                NewTabBtnElem: $("#btnNewTab"),
                ConfigBtnElem: $("#btnConfig"),
                NotesButtonElem: $('#btnNotes'),
                NotesButtonBadgeElem: $("#NotesBadge"),
                KBButtonElem: $("#btnKB"),
                JiraBtnElem: $("#btnJira"),
                OptPort5Elem: $("#Port5"),
                OptPort4Elem: $("#Port4"),
                OptPort3Elem: $("#Port3"),
                OptPort2Elem: $("#Port2"),
                OptPort1Elem: $("#Port1"),
                P1ContentElem: $("#p1Content"),
                P2ContentElem: $("#p2Content"),
                P3ContentElem: $("#p3Content"),
                P4ContentElem: $("#p4Content"),
                P5ContentElem: $("#p5Content"),
                BtnDefaultPortElem: $("#btnDefConfig"),
                BtnSavePortElem: $("#btnSaveConfig"),
                BtnCancelPortElem: $("#btnCancelConfig"),
                NotePadFrameElem: $("#NotePadFrame"),
                UserBtnElem: $("#btnUser"),
            };

            me.init = function (settings) {
                $.extend(me.config, settings);

                me.config.UserBtnElem.kendoTooltip({
                    content: function(e) {
                        var t = "Currnet user: " + sessionID;
                        return t;
                    }
                });
                $("#ReservedImg").kendoTooltip({
                    content: function(e) {
                        var t = "<span style='color: #FF8080'>Another user is already looking at this BAR: <strong >" + ConcurrentUser + "</strong></span>";
                        return t;
                    }
                });

                //Current User Name
                var uname = SaveSizesFunctions.GetUserName();
                console.log("user name: ", uname);
                if (uname && uname.trim().length > 0) {
                    sessionID = uname;
                    me.config.UserBtnElem.data("kendoTooltip").refresh();
                } else {
                    //Get and store a user name
                    me.GetUserName();
                }

                recent = SaveSizesFunctions.GetRecent();
                if (!recent) recent = [];

                me.CreatePanels();
                me.LoadCSV();
                bindUIActions();
            };

            var bindUIActions = function () {
                $(window).on("resize orientationchange", function () {
                    throttledResize();
                });

                me.config.recentLblElem.on("click", function () {
                    me.config.recentElem.toggle();
                });

                me.config.recentElem.on("click", ".RecentButton", function () {
                    var BAR = $(this).data("bar");
                    var n = $(this).text();
                    var p = $(this).data("phone");
                    var s = $(this).data("store");
                    me.LoadPanels(BAR, n, p, s);
                });

                me.config.QuickBasePopupBtnElem.on("click", function () {
                    var URL = "https://toshibagcs.quickbase.com";
                    var Title = "Quickbase";
                    //me.PopupUrl(URL, Title);
                    window.open(URL, "_blank", "toolbar=yes,scrollbars=yes,resizable=yes");
                    return false;
                });
                me.config.DevopsPopupBtnElem.on("click", function () {
                    //var URL = "https://dev.azure.com/jblprd/Badger/";
                    //switch devops to Jira
                    var URL = "https://badgertech.atlassian.net/jira/servicedesk/projects/FIT/queues/custom/14";
                    var Title = "Jira";
                    //me.PopupUrl(URL, Title);
                    window.open(URL, "_blank", "toolbar=yes,scrollbars=yes,resizable=yes");
                    return false;
                });
                me.config.WalmartPopupBtnElem.on("click", function () {
                    var URL = "https://walmart-admin.gcp.badger-service.com/skybox";
                    var Title = "Walmart Skybox";
                    //me.PopupUrl(URL, Title);
                    window.open(URL, "_blank", "toolbar=yes,scrollbars=yes,resizable=yes");
                    return false;
                });
                me.config.ConsolePopupBtnElem.on("click", function () {
                    var URL = "https://10.210.232.187:4200/";
                    var Title = "Web Shell Linux Console";
                    //me.PopupUrl(URL, Title);
                    window.open(URL, "_blank", "toolbar=yes,scrollbars=yes,resizable=yes");
                    return false;
                });

                me.config.VerifPopupBtnElem.on("click", function () {
                    var URL = baseURL + currentBar + "/verification";
                    var Title = "Verification";
                    me.PopupUrl(URL, Title);
                    return false;
                });

                me.config.KBButtonElem.on("click", function () {
                    //var URL = "http://10.210.233.122:220/index.php";
                    var Title = "Knowledgebase";
                    //me.PopupUrl(URL, Title);
                    window.open(me.KBURL, "_blank", "toolbar=yes,scrollbars=yes,resizable=yes");
                    return false;
                });

                me.config.JiraBtnElem.on("click", function () {
                    $("#jsd-widget").toggle(800);
                    return false;
                });


                me.config.MaximizeContainerElem.on("click", ".MaxButton", function () {
                    var portnum = parseInt($(this).data("portnum"));
                    var page = me.PortConfiguration["P" + portnum + "Page"];
                    var URL = baseURL + currentBar + "/" + page;
                    var Title = "Maximized Port: " + page;
                    me.MaximizePort(URL, Title); return false;
                });

                me.config.PortLblsBtnElem.on('click', function () {
                    var isHidden = $(".PortLabel").eq(0).hasClass("HideLabel");
                    if (isHidden) {
                        $(".PortLabel").removeClass("HideLabel");
                    } else {
                        $(".PortLabel").addClass("HideLabel");
                    }
                    SaveSizesFunctions.SavePortLblbVis(isHidden);
                });

                me.config.ContentDivElem.on("click", ".ReloadButton", function () {
                    var port = $(this).data("portnum");
                    $("#" + port).prop("src", $("#" + port).prop("src"));
                });

                me.config.NewTabBtnElem.on("click", function () {
                    var url = [location.protocol, '//', location.host, location.pathname].join('');
                    url = url + '?db=' + currentBar;
                    var win = window.open(url, '_blank');
                    win.focus();
                });

                me.config.ConfigBtnElem.on("click", function () {
                    me.LaunchConfig();
                    return false;
                });


                me.config.NotesButtonElem.on("click", function () {
                    var IsVisible = me.config.NotePadFrameElem.is(":visible");
                    if (IsVisible) {
                        me.config.NotePadFrameElem.prop("src", "about:blank").slideUp(300);
                    } else {
                        var offset = me.config.NotesButtonElem.offset();
                        var l = offset.left - me.config.NotePadFrameElem.width() + me.config.NotesButtonElem.outerWidth(true);
                        if (l < 0) l = 0;
                        me.config.NotePadFrameElem.css("left", l);
                        me.config.NotePadFrameElem.css("top", offset.top + me.config.NotesButtonElem.outerHeight(true) + 1);
                        var url = NotePadURL;
                        me.config.NotePadFrameElem.prop("src", url).slideDown(600);
                    }

                    LastNoteCheck = new Date().getTime();
                    me.config.NotesButtonBadgeElem.addClass("hidden").text("0");
                });
                me.config.NotesButtonBadgeElem.on("click", function () {
                    LastNoteCheck = new Date().getTime();
                    me.config.NotesButtonBadgeElem.addClass("hidden").text("0");
                });

                $(".portsel").on("click", function (e) {
                    $(this).closest("label").find("input").prop("checked", true).change();
                });

                $('input:radio[name="PortSelect"]').on("change", function (e) {
                    var val = $(this).val();
                    $(".content-picker").show();
                    if (val == 4) {
                        $(".content-picker.hide4").hide();
                    } else if (val == 3) {
                        $(".content-picker.hide3").hide();
                    } else if (val == 2) {
                        $(".content-picker.hide2").hide();
                    } else if (val == 1) {
                        $(".content-picker.hide1").hide();
                    }
                });

                me.config.BtnSavePortElem.on("click", function () {
                    me.SaveConfig();
                    return false;
                });
                me.config.BtnCancelPortElem.on("click", function () {
                    me.CancelConfig();
                    return false;
                });
                me.config.BtnDefaultPortElem.on("click", function () {
                    me.DefaultConfig();
                    return false;
                });

                me.config.UserBtnElem.on("click", function () {
                    me.GetUserName();
                });
            };

            var getQueryVariable = function (variable) {
                var query = window.location.search.substring(1);
                var vars = query.split('&');
                for (var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split('=');
                    if (decodeURIComponent(pair[0]) == variable) {
                        return decodeURIComponent(pair[1]);
                    }
                }
                //console.log('Query variable %s not found', variable);
                return -1;
            }

            var throttledResize = kendo.throttle(function () {
                //CreateTheGrid(); //recreate the grid with the new height
                var h = CalcGridHeight();
                $("#vertical").height(h);

                var splitter = $("#vertical").data("kendoSplitter");
                if (splitter) {
                    var s = GetSplitterSizes();
                    splitter.size(".k-pane:first", s.top);
                }

                //place notes badge
                var notesLeft = me.config.NotesButtonElem.offset().left + me.config.NotesButtonElem.width();
                var notesTop = 0;
                me.config.NotesButtonBadgeElem.css("left", notesLeft + "px").css("top", notesTop + "px")

            }, 100);

            var CalcGridHeight = function () {
                var availH = me.config.ContentDivElem.height();
                var bH = me.config.ButtonRowElem.outerHeight(true);
                var h = availH - bH;
                return h;
            };

            var SaveSplitterSizes = function () {
                var numports = parseInt(me.PortConfiguration.NumberPorts);
                var sizes = {};


                if (numports > 2) {
                    var topH = $("#top-pane").outerHeight();
                    var botH = $("#bottom-pane").outerHeight();
                    if ((topH + botH) < 50) {
                        sizes.top = 50;
                    } else {
                        sizes.top = topH * 100 / (topH + botH);
                    }

                    //top horizontal
                    if (numports == 3) {
                        sizes.topLeft = 100;
                    } else {
                        var p1W = $("#Port1").width();
                        var p2W = $("#Port2").width();
                        if ((p1W + p2W) < 50) {
                            sizes.topLeft = 50;
                        } else {
                            sizes.topLeft = p1W * 100 / (p1W + p2W);
                        }
                    }

                    //bottom horizontal
                    if (numports == 5) {
                        var p3W = $("#Port3").width();
                        var p4W = $("#Port4").width();
                        var p5W = $("#Port5").width();
                        var bTotal = p3W + p4W + p5W;
                        if (bTotal < 50) {
                            sizes.botLeft = 33.3;
                            sizes.botCent = 33.3;
                        } else {
                            sizes.botLeft = p3W * 100 / bTotal;
                            sizes.botCent = p4W * 100 / bTotal;
                        }
                    } else if (numports == 4) {
                        var p3W = $("#Port3").width();
                        var p4W = $("#Port4").width();
                        var bTotal = p3W + p4W;
                        if (bTotal < 50) {
                            sizes.botLeft = 50;
                        } else {
                            sizes.botLeft = p3W * 100 / bTotal;
                        }
                    } else if (numports == 3) {
                        var p2W = $("#Port2").width();
                        var p3W = $("#Port3").width();
                        var bTotal = p2W + p3W;
                        if (bTotal < 50) {
                            sizes.botLeft = 50;
                        } else {
                            sizes.botLeft = p2W * 100 / bTotal;
                        }
                    }

                } else {
                    var topH = $("#Port1").width();
                    var botH = $("#Port2").width();
                    if ((topH + botH) < 50) {
                        sizes.top = 50;
                    } else {
                        sizes.top = topH * 100 / (topH + botH);
                    }
                }

                SaveSizesFunctions.SaveSizes(sizes, numports);
            }

            var GetSplitterSizes = function () {
                var sSizes = {
                    top: "50%",
                    topLeft: "50%",
                    botLeft: "33.33%",
                    botCent: "33.33%"
                }

                var s = SaveSizesFunctions.GetSaveSizes(me.PortConfiguration.NumberPorts);
                if (s) {
                    if (s.top) sSizes.top = Math.round(s.top) + "%";
                    if (s.topLeft) sSizes.topLeft = Math.round(s.topLeft) + "%";
                    if (s.botLeft) sSizes.botLeft = Math.round(s.botLeft) + "%";
                    if (s.botCent) sSizes.botCent = Math.round(s.botCent) + "%";
                }
                return sSizes
            }

            me.LoadCSV = function () {

                IsWalmart = getQueryVariable("IsWalmart") == "yes";
                if (IsWalmart) {
                    datacsvfile = "./BARsWalmart.csv?v=1.1";
                    baseURL = "https://walmart-admin.gcp.badger-service.com/robots/"
                    $("#walamarticon").removeClass("hidden");
                }


                $.ajax({
                    type: 'GET',
                    url: datacsvfile,
                    dataType: 'text',
                }).done(function (response) {
                    if (response && response.length > 0) {
                        BARs = $.csv.toObjects(response);
                    }

                    me.config.BARNumSelElem.kendoDropDownList({
                        filter: "contains",
                        dataTextField: "BAR",
                        dataValueField: "DB",
                        dataSource: BARs,
                        select: function (e) {
                            var item = e.dataItem;
                            me.LoadPanels(item.DB, item.BAR, item.PHONE, item.STORE_SITE_ID);
                        }
                    });
                    STOREs = [];
                    for (var i = 0; i < BARs.length; i++) {
                        if (BARs[i].STORE_SITE_ID && BARs[i].STORE_SITE_ID.length > 0) {
                            STOREs.push(BARs[i]);
                        }
                    }
                    STOREs.sort(StoreCompare);
                    me.config.STORENumSelElem.kendoDropDownList({
                        filter: "contains",
                        dataTextField: "STORE_SITE_ID",
                        dataValueField: "DB",
                        dataSource: STOREs,
                        select: function (e) {
                            var item = e.dataItem;
                            me.LoadPanels(item.DB, item.BAR, item.PHONE, item.STORE_SITE_ID);
                        }
                    });
                    //console.log("BARs", BARs);
                    //console.log("STOREs", STOREs);

                }).fail(function (jqXHR, textStatus, errorThrown) {
                    console.log("LoadCSV Fail:", jqXHR);
                }).always(function () {
                    //load query string if provided
                    me.LoadQueryDB();

                    //tooltips
                    var tooltip = $("[title]").kendoTooltip({
                        position: "bottom",
                        animation: {
                            open: {
                                effects: "zoom",
                                duration: 150
                            }
                        }
                    }).data("kendoTooltip");

                });
            };

            me.LoadQueryDB = function () {
                QueryDB = getQueryVariable("db");
                if (QueryDB != -1) {
                    var found = false;
                    // see if we can get the BAR and PHONE
                    var bName = QueryDB;
                    var phoneNum = "";
                    var storenum = "";
                    for (var i = 0; i < BARs.length; i++) {
                        if (BARs[i].DB == QueryDB) {
                            bName = BARs[i].BAR;
                            phoneNum = BARs[i].PHONE;
                            storenum = BARs[i].STORE_SITE_ID;
                            found = true;
                            break;
                        }
                    }
                    if (found) {
                        var dropdownlist = me.config.BARNumSelElem.data("kendoDropDownList");
                        dropdownlist.select(function (dataItem) {
                            return dataItem.DB == QueryDB;
                        });
                    }

                    me.LoadPanels(QueryDB, bName, phoneNum, storenum);
                } else {
                    //load first item
                    var dropdownlist = me.config.BARNumSelElem.data("kendoDropDownList");
                    var dataItem = dropdownlist.dataItem();
                    me.LoadPanels(dataItem.DB, dataItem.BAR, dataItem.PHONE);
                }
            }

            me.LoadRecent = function () {
                if (recent && recent.length > 0) {
                    //add buttons for each
                    var html = '';
                    for (var i = 0; i < recent.length; i++) {
                        var arrRecent = recent[i].split("|");
                        var db = arrRecent[0];
                        var n = db;
                        var p = "";
                        if (arrRecent.length > 1) n = arrRecent[1] || db;
                        if (arrRecent.length > 2) p = arrRecent[2] || "";
                        html += '<button class="k-button RecentButton" data-role="button" type="button" data-bar="' + db + '" data-phone="' + p + '" title="Load ' + n + '">' + n + '</button>'
                    }
                    me.config.recentElem.empty().append(html);
                    var tooltip = $(".RecentButton[title]").kendoTooltip({
                        position: "bottom",
                        animation: {
                            open: {
                                effects: "zoom",
                                duration: 150
                            }
                        }
                    }).data("kendoTooltip");

                }

            };

            me.GetNotepadURL = function (BAR) {
                //NotePadURL = "http://10.210.232.187:3000?DB=" + currentBar;

                //var arrayLength = BARs.length;
                //for (var i = 0; i < arrayLength; i++) {
                //    if (BARs[i].DB == BAR) {
                //        if (is.propertyDefined(BARs[i], 'NOTEPADURL') && BARs[i].NOTEPADURL) {
                //            NotePadURL = BARs[i].NOTEPADURL;
                //        }
                //        break;
                //    }
                //}

                NotePadURL = "notepad.html?id=" + me.CreateBotID() + "&author=" + sessionID;
                console.log("Notepad URL: ", NotePadURL);
            };

            me.LoadPanels = function (BAR, BARNAME, PHONE, STORE) {
                var p = PHONE || "";
                if (STORE && STORE.trim().length > 0) {
                    p = p + "  (" + STORE.trim() + ")"
                }
                me.config.currentPHONEElem.html(p);

                if (BAR) {
                    if (currentBar == BAR) return;
                    currentBar = BAR;

                    clearInterval(ReserveTimer);
                    clearInterval(NotesTimer);

                    me.GetNotepadURL(BAR);
                    
                    me.ReserveBAR();
                    ReserveTimer = setInterval(me.ReserveBAR, 8000);
                    LastNoteCheck = new Date().getTime();
                    NotesTimer = setInterval(me.NewNotesCheck, 20000);

                    document.title = BARNAME + " EZMV";
                    me.ReloadCurrent();

                    me.config.currentBARElem.text(BARNAME);

                    var recBAR = BAR + "|" + BARNAME + "|" + p;
                    if (recent.indexOf(recBAR) < 0) {
                        recent.unshift(recBAR);
                        if (recent.length > 6) recent.pop();
                        SaveSizesFunctions.SaveRecent(recent);
                        me.LoadRecent();
                    }

                } else {
                    kendo.alert("Please select a valid BAR number first.");
                }
            }

            me.GetURL = function (page) {
                var base = baseURL + currentBar + "/";

                var ret = ""
                if (page == "notepad") {
                    ret = NotePadURL;
                } else if (page == "kb") {
                    ret = me.KBURL;
                } else if (page == "skybox-bot-list") {
                    ret = me.SkyboxListURL;
                } else {
                    ret = base + page;
                }

                return ret;
            };
            me.ReloadCurrent = function () {
                if (currentBar) {
                    if (me.ReloadSkybox(me.PortConfiguration.P1Page, $("#F1"))) $("#F1").prop("src", me.GetURL(me.PortConfiguration.P1Page));
                    if (me.ReloadSkybox(me.PortConfiguration.P2Page, $("#F2"))) $("#F2").prop("src", me.GetURL(me.PortConfiguration.P2Page));
                    if (me.ReloadSkybox(me.PortConfiguration.P3Page, $("#F3"))) $("#F3").prop("src", me.GetURL(me.PortConfiguration.P3Page));
                    if (me.ReloadSkybox(me.PortConfiguration.P4Page, $("#F4"))) $("#F4").prop("src", me.GetURL(me.PortConfiguration.P4Page));
                    if (me.ReloadSkybox(me.PortConfiguration.P5Page, $("#F5"))) $("#F5").prop("src", me.GetURL(me.PortConfiguration.P5Page));
                }
            };
            me.ReloadSkybox = function(page, frame) {
                var ret = true;
                if (page == "skybox-bot-list"){
                    var framurl = frame.prop("src");
                    if (framurl == me.SkyboxListURL){
                        ret = false;
                    }
                }
                return ret;
            };

            me.CreatePanels = function () {

                me.LoadRecent();
                //resize the container to current window height
                throttledResize();

                //get port config
                me.PortConfiguration = SaveSizesFunctions.GetPorConfig();

                me.ConfigurePorts();


                me.config.PopupWinElem.kendoWindow({
                    visible: false,
                    modal: true,
                    iframe: true,
                    actions: ["Minimize", "Maximize", "Close"],
                    resizable: true,
                    width: "88%",
                    height: '88vh',
                    animation: {
                        open: { effects: "zoomIn slideIn:left", duration: 400 },
                        close: { effects: "zoomIn slideIn:right", duration: 300, reverse: true }
                    },
                    content: "about:blank",
                    close: function () {
                        me.config.PopupWinElem.find("iframe").eq(0).prop("src", "");
                    },
                });

                me.config.MaxPortWinElem.kendoWindow({
                    visible: false,
                    modal: true,
                    iframe: true,
                    actions: ["Maximize", "Close"],
                    resizable: true,
                    width: "98%",
                    height: '94vh',
                    animation: {
                        open: { effects: "zoomIn slideIn:left", duration: 400 },
                        close: { effects: "zoomIn slideIn:right", duration: 300, reverse: true }
                    },
                    content: "about:blank",
                    close: function () {
                        me.config.PopupWinElem.find("iframe").eq(0).prop("src", "");
                    },
                });

                me.config.ConfigWinElem.kendoWindow({
                    visible: false,
                    modal: true,
                    actions: ["Close"],
                    resizable: true,
                    maxHeight: '85vh',
                    animation: {
                        open: { effects: "zoomIn slideIn:left", duration: 400 },
                        close: { effects: "zoomIn slideIn:right", duration: 300, reverse: true }
                    }
                });

                $(".content-picker-cont input").each(function (idx) {
                    $(this).kendoDropDownList({
                        index: idx,
                        dataSource: ["position", "info", "commands", "lifecycle-transitions", "play-executions", "notepad", "kb", "skybox-bot-list"],
                    });
                });


                var IsVis = SaveSizesFunctions.GetPortLblbVis();
                if (!IsVis) {
                    setTimeout(function () {
                        $(".PortLabel").addClass("HideLabel");
                    }, 100);
                }
            }

            me.PopupUrl = function (URL, title) {
                me.config.PopupWinElem.find("iframe").eq(0).prop("src", URL);
                var kendoWindow = me.config.PopupWinElem.data("kendoWindow");
                kendoWindow.title(title).center().open();
                return false;
            };

            me.MaximizePort = function (URL, title) {
                me.config.MaxPortWinElem.find("iframe").eq(0).prop("src", URL);
                var kendoWindow = me.config.MaxPortWinElem.data("kendoWindow");
                kendoWindow.title(title).center().open();
                return false;
            };

            me.LaunchConfig = function () {
                var kendoWindow = me.config.ConfigWinElem.data("kendoWindow");
                kendoWindow.title("Configure").center().open();
                return false;
            };
            me.CancelConfig = function () {
                var kendoWindow = me.config.ConfigWinElem.data("kendoWindow");
                if (kendoWindow) kendoWindow.close();
            };
            me.DefaultConfig = function () {
                me.PortConfiguration = DefaultPortConfiguration;
                me.ConfigurePorts();
            };
            me.SaveConfig = function () {
                var NumberPorts = 5;
                NumberPorts = $("input[name='PortSelect']:checked").val();
                me.PortConfiguration.NumberPorts = NumberPorts;
                me.PortConfiguration.P1Page = me.config.P1ContentElem.data("kendoDropDownList").text();
                if (NumberPorts == 5) {
                    me.PortConfiguration.P3Page = me.config.P3ContentElem.data("kendoDropDownList").text();
                    me.PortConfiguration.P4Page = me.config.P4ContentElem.data("kendoDropDownList").text();
                    me.PortConfiguration.P5Page = me.config.P5ContentElem.data("kendoDropDownList").text();
                    me.PortConfiguration.P2Page = me.config.P2ContentElem.data("kendoDropDownList").text();
                } else if (NumberPorts == 4) {
                    me.PortConfiguration.P3Page = me.config.P3ContentElem.data("kendoDropDownList").text();
                    me.PortConfiguration.P4Page = me.config.P4ContentElem.data("kendoDropDownList").text();
                    me.PortConfiguration.P2Page = me.config.P2ContentElem.data("kendoDropDownList").text();
                } else if (NumberPorts == 3) {
                    me.PortConfiguration.P3Page = me.config.P3ContentElem.data("kendoDropDownList").text();
                    me.PortConfiguration.P2Page = me.config.P2ContentElem.data("kendoDropDownList").text();
                } else if (NumberPorts == 2) {
                    me.PortConfiguration.P2Page = me.config.P2ContentElem.data("kendoDropDownList").text();
                }
                me.ConfigurePorts();
            };

            me.ConfigurePorts = function () {
                me.CancelConfig();
                me.PortConfiguration.P1Title = TitleFromPage(me.PortConfiguration.P1Page);
                me.PortConfiguration.P2Title = TitleFromPage(me.PortConfiguration.P2Page);
                me.PortConfiguration.P3Title = TitleFromPage(me.PortConfiguration.P3Page);
                me.PortConfiguration.P4Title = TitleFromPage(me.PortConfiguration.P4Page);
                me.PortConfiguration.P5Title = TitleFromPage(me.PortConfiguration.P5Page);
                //console.log("Port Configuration:  ", me.PortConfiguration);
                SaveSizesFunctions.SavePortConfig(me.PortConfiguration);
                var templateSelector = "Port" + me.PortConfiguration.NumberPorts + "Template";
                var template = kendo.template($("#" + templateSelector).html());
                var result = template(me.PortConfiguration); //Execute the template

                DestroySplitter($("#horizontalB"));
                DestroySplitter($("#horizontalT"));
                DestroySplitter($("#vertical"));
                $("#vertical").replaceWith(result);
                CreateSplitters();
                me.ReloadCurrent();

                // hide maximize buttons for unused ports
                var curNum = parseInt(me.PortConfiguration.NumberPorts);
                me.config.MaximizeContainerElem.find(".MaxButton").each(function (idx) {
                    var portnum = parseInt($(this).data("portnum"));
                    var page = me.PortConfiguration["P" + portnum + "Title"];
                    if (portnum <= curNum) {
                        $(this).show().prop("title", "Maximize port: " + page);
                    } else {
                        $(this).hide();
                    }
                });
            };

            var DestroySplitter = function (elem) {
                if (elem.length) {
                    var splitter = elem.data("kendoSplitter");
                    if (splitter) {
                        splitter.destroy();
                    }
                }
            };
            var CreateSplitters = function () {
                // $("#vertical")
                // $("#horizontalT"),
                // $("#horizontalB"),
                var sizes = GetSplitterSizes();
                //console.log("GetSavedSizes:", sizes);
                var orient = "vertical";
                if (me.PortConfiguration.NumberPorts == 2 || me.PortConfiguration.NumberPorts == 3) orient = "horizontal";
                $("#vertical").kendoSplitter({
                    orientation: orient,
                    panes: [
                        { collapsible: false, scrollable: false, size: sizes.top },
                        { collapsible: false, scrollable: false },
                    ],
                    resize: function (e) {
                        SaveSplitterSizes();
                    }
                });

                if (me.PortConfiguration.NumberPorts == 5) {
                    $("#horizontalT").kendoSplitter({
                        panes: [
                            { collapsible: true, scrollable: false, size: sizes.topLeft },
                            { collapsible: true, scrollable: false }
                        ],
                        resize: function (e) {
                            SaveSplitterSizes();
                        }
                    });
                    $("#horizontalB").kendoSplitter({
                        panes: [
                            { collapsible: true, scrollable: false, size: sizes.botLeft },
                            { collapsible: false, scrollable: false, size: sizes.botCent },
                            { collapsible: true, scrollable: false }
                        ],
                        resize: function (e) {
                            SaveSplitterSizes();
                        }
                    });
                }
                if (me.PortConfiguration.NumberPorts == 4) {
                    $("#horizontalT").kendoSplitter({
                        panes: [
                            { collapsible: true, scrollable: false, size: sizes.topLeft },
                            { collapsible: true, scrollable: false }
                        ],
                        resize: function (e) {
                            SaveSplitterSizes();
                        }
                    });
                    $("#horizontalB").kendoSplitter({
                        panes: [
                            { collapsible: true, scrollable: false, size: sizes.botLeft },
                            { collapsible: false, scrollable: false },
                        ],
                        resize: function (e) {
                            SaveSplitterSizes();
                        }
                    });
                }
                if (me.PortConfiguration.NumberPorts == 3) {
                    $("#horizontalT").kendoSplitter({
                        panes: [
                            { collapsible: true, scrollable: false, size: "100%" },
                        ]
                    });
                    $("#horizontalB").kendoSplitter({
                        orientation: "vertical",
                        panes: [
                            { collapsible: true, scrollable: false, size: sizes.botLeft },
                            { collapsible: false, scrollable: false },
                        ],
                        resize: function (e) {
                            SaveSplitterSizes();
                        }
                    });
                }

                throttledResize();

            };

            me.CreateBotID = function(){
                var botid = "DB" + currentBar;
                if (IsWalmart) {
                    botid += "Walmart";
                }
                return botid;
            };

            me.ReserveBAR = function() {
                var botid = me.CreateBotID();
                $.ajax({
                    url: "./api/conc/",
                    type: 'POST',
                    dataType: "json",
                    contentType: "application/json",
                    data: JSON.stringify({botid: botid, author: sessionID}),
                })
                .done(function (response) {
                    if (response.haveControl) {
                        $("#ReservedImg").addClass("hidden");
                    } else {
                        $("#ReservedImg").removeClass("hidden");
                        ConcurrentUser = response.currentController;
                        $("#ReservedImg").data("kendoTooltip").refresh();
                    }
                });
            };

            me.NewNotesCheck = function () {
                var botid = me.CreateBotID();
                $.ajax({
                    url: "./api/notes/" + botid,
                    type: 'GET',
                    contentType: "application/json",
                })
                .done(function( response ) {
                    console.log("NewNotesCheck: ", response);
                    var count = 0;
                    for (var i = 0; i < response.data.length; i++) {
                        var ts = new Date(response.data[i].notetime).getTime();
                        var auth = response.data[i].author;
                        if (ts > LastNoteCheck && auth != sessionID) {
                            count++;
                        }
                    }
                    if (count > 0) {
                        //place notes badge
                        var notesLeft = me.config.NotesButtonElem.offset().left + me.config.NotesButtonElem.width();
                        var notesTop = 0;
                        me.config.NotesButtonBadgeElem.css("left", notesLeft + "px").css("top", notesTop + "px")
                        me.config.NotesButtonBadgeElem.removeClass("hidden").text(count);
                    } else {
                        me.config.NotesButtonBadgeElem.addClass("hidden").text("0");
                    }

                });
            }

            me.GetUserName = function () {
                kendo.prompt("Please enter your name (used for reserving BOTs and for Notes):", "").then(function (data) {
                    if (data && data.trim().length > 0) {
                        sessionID = data;
                        SaveSizesFunctions.SaveUserName(sessionID);
                        console.log("User name: ", sessionID);
                        me.config.UserBtnElem.data("kendoTooltip").refresh();
                    } else {
                        kendo.alert(kendo.format("You chose not to enter a name, so we will use: '{0}'", sessionID));
                    }
                }, function () {
                    kendo.alert(kendo.format("You chose not to enter a name, so we will use: '{0}'", sessionID));
                });
            }

            return me;
        }();



        $(function () {
            //jQuery is ready
            MainModule.init();

            setTimeout(function () { $("#jsd-widget").toggle(800); }, 1000);
        });

    </script>
</body>
</html>